# 2021-10-18 TIL

## this

- 자바스크립트의 this
    - 다른 대부분의 객체지향 언어에서의 this는 클래스에서만 사용가능하며, 클래스가 미래에 생성할 인스턴스를 의미한다.
    - 하지만, 자바스크립트에서는 this 키워드를 어디서나 사용할 수 있다.
    - 또한, 어떤 상황에서 this를 사용했느냐에 따라 그것이 무엇을 의미할지가 달라진다.
    - 이 때문에 종종 this가 예상과 다른 방식으로 작동하는 경우가 생기는데, 그렇기에 this의 의미가 달라지는 각각의 상황들을 알고있어야 한다.
    - this가 가리킬 객체는 실행 컨텍스트가 생성될 때 결정되어 실행컨텍스트의 thisBinding 항목이 참조하게 된다.
    - 전역 컨텍스트와 블록에 의한 실행 컨텍스트 생성을 제외하면, 실행 컨텍스트는 함수 호출에 의해서만 생성되기 때문에, ```this는 함수를 호출할 때 결정된다```고 할 수 있다.
    - 따라서, 함수를 어떤 방식으로 호출하느냐에 따라 그 함수 내부에서, 그 실행 컨텍스트 내부에서 this가 특정 객체를 가리킬 규칙이 결정된다.
    - 공통적으로 적용되는 규칙이 있는데, ```this는 함수를 호출한 주체를 가리킨다.```는 것이다.
- 전역공간에서 this
    - 전역공간에서, 즉 전역 컨텍스트에서 this는 전역 객체를 가리킨다.
    - 런타임 환경에 따라 전역 객체가 다른데, 브라우저에서 전역 객체는 window이고, nodejs에서 전역 객체는 global이다.
- 함수를 메서드로서 호출했을 때 this
    - 함수를 호출하는 가장 일반적인 두 가지 방법은 함수를 함수로서 호출하는 것과, 메서드로서 호출하는 것이다.
        - 둘 다 ```미리 정의한 동작을 수행하는 코드뭉치```라고 할 수 있는데, 유일한 차이점은 ```독립성```이다.
        - 함수는 그 자체로 독립적인 기능을 수행하지만, 메서드는 자신을 호출한 객체에 관한 기능을 수행한다.
    - 함수로서의 호출과 메서드로서의 호출은 무엇으로 구분하는가?
        - 함수 앞에 .이 있으면 메서드로서의 호출이고, 없으면 아니다.(혹은 대괄호 표기법)
    - 메서드 내부에서 this는 .앞에 있는 객체, 즉 본인을 호출한 주체를 가리킨다.
- 함수를 함수로서 호출했을 때 this
    - 함수에 의해 실행 컨텍스트가 생성될 때, this는 함수를 호출한 주체를 가리킨다고 했다.
    - 여기서 '주체'는 '객체지향언어'에서 그 객체이다.
    - 함수를 함수로서 호출하는 것은 객체들의 세상에서 어느 객체에 의해 벌어진 일이 아니라, 외부의 개발자가 직접 관여하여 실행한 것이다.
    - 즉, 함수를 함수로서 호출했을 때 호출의 주체는 알 수 없다.
    - 때문에 this가 지정되지 않는데, this가 지정되지 않는 경우에는 그대로 비워두지 않고, 전역 객체를 가리키게 한다.
- 함수를 콜백함수로 넘겨줬을 때 this
    - 어떤 함수 A의 제어권을 다른 함수B에게 넘겨주는 경우, 그러한 A함수를 콜백함수라고 한다.
    - 제어권을 넘겨줬으니 A는 B의 내부 로직에 따라 실행되며, this도 B의 내부 로직에서 정한 규칙을 따른다.
    - 기본적으로는 콜백함수도 함수로서 호출되는 것이기 때문에 this가 전역 객체를 가리키지만, 제어권을 받은 함수가 별도의 규칙을 정해놓았다면 그것에 의해 this가 정해진다.
    - 예를 들어, addEventListener는 메서드로서 호출되어, 제어권을 넘겨받은 콜백함수를 call을 통해 본인을 호출한 주체를 바인딩하여 실행시킨다.  
- 함수를 생성자로서 호출했을 때 this
    - 자바스크립트에서 모든 함수는 new키워드와 함께 생성자로서 호출될 수 있다.
    - 생성자로 호출되었을 때 함수 내부에서 this는 생성자가 만들어낼 인스턴스를 가리킨다.
- 화살표 함수의 this
    - 화살표 함수는 실행 컨텍스트 생성 시 thisBinding을 결정하는 과정이 아예 없다.
    - 즉, 함수 내부에는 this가 아예 없는데, this에 접근하고자 하면 스코프 체인 상 가장 가까운 this에 접근한다.
    - 이는 꽤나 합리적인 규칙인 듯 하다.
- call/apply/bind에 의해 호출되었을 때 this
    - 위의 모든 상황들은 this가 암묵적으로 결정된다.
    - this를 명시적으로 결정할 수 있게 하는 것이 Function.prototype에 정의되어있는 call / apply / bind 메서드이다.
    - 세 메서드 모두 본인의 호출 주체인 함수가 실행될 때 내부의 this가 가리키게 할 객체를 첫번째 인자로 받는다.
    - call, bind는 본인의 호출 주체인 함수가 실행될 때 넘겨줄 인자를 나머지 인자로 받는다.
    - apply는 본인의 호출 주체인 함수가 실행될 때 넘겨줄 인자를 두번째 인자로 배열로서 받는다.
    - call, apply는 본인의 호출 주체인 함수를 즉시 실행시킨다.
    - bind는 본인의 호출 주체인 함수를 부분적으로 변형시킨 새로운 함수를 반환한다.
- 정리
    - 전역 공간에서 this는 전역 객체를 가리킨다.
    - 함수를 함수로서 호출했을 때 this는 전역 객체를 가리킨다.
    - 함수를 메서드로서 호출했을 때 this는 본인의 호출 주체를 가리킨다.
    - 함수를 생성자로서 호출했을 때 this는 생성자가 만들어낼 인스턴스를 가리킨다.
    - 콜백함수는 기본적으로 함수로서 실행되는 것이므로 this가 전역 객체를 가리키지만, 제어권을 넘겨받은 함수에서 따로 규칙을 두었다면 그것을 따른다.
    - 화살표 함수는 this 바인딩 과정을 생략하며, this에 접근하면 스코프 체인 상 가장 가까운 실행 컨텍스트의 this에 접근하게 된다.
    - call / apply / bind 메서드를 이용하면 명시적으로 this를 바인딩 할 수 있다.

### reference
[코어 자바스크립트](http://www.yes24.com/Product/Goods/78586788?OzSrank=1)